<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Calculator</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="wrapper"></div>
    <script>
      // TODO add change skins functionality, add buttons for that
            document.addEventListener('DOMContentLoaded', (event) => {
              const calculator = new Calculator();
              calculator.drawScreen();
              calculator.drawButtonSecton();
              calculator.bindEvents();
            });

            class Calculator {
              constructor() {
                this.buttons = [{'CE': 'global clear'}, {'C': 'clear'}, {'NEG': 'negative'}, {'/': 'divide'},
                {'7': '7'}, {'8': '8'}, {'9': '9'}, {'*': 'multiply'}, {'4': '4'}, {'5': '5'}, {'6': '6'},
                {'-': 'subtract'}, {'1': '1'}, {'2': '2'}, {'3': '3'}, {'+': 'add'}, {'0': '0'}, {'.': 'point'},
                {'%': 'percent'}, {'=': 'equals'}];
                // this.total = 0;
                // this.lastOperation = '';
                // this.subtotal = 0; // window top part
                // this.currentNumber = 0; // window bottom part

                this.operationsScreen = document.querySelector('#screen #top-section'); // top part
                this.currentNumScreen = document.querySelector('#screen #bottom-section'); // bottom part
                this.result = 0;
                this.currentOp = '+';
                this.resultStatus =  false;

                
              }

              drawScreen() {
                const wrapperDiv = document.getElementById('wrapper');
                const screenDiv = document.createElement('div');
                screenDiv.setAttribute('id', 'screen');
                const topPartScreen = document.createElement('div');
                topPartScreen.setAttribute('id', 'top-section');

                const bottomPartScreen = document.createElement('div');
                bottomPartScreen.setAttribute('id', 'bottom-section');

                screenDiv.appendChild(topPartScreen);
                screenDiv.appendChild(bottomPartScreen);
                wrapperDiv.appendChild(screenDiv);

              }

              drawButtonSecton() {
                const wrapperDiv = document.getElementById('wrapper');
                wrapperDiv.setAttribute('id', 'wrapper');
                const buttonsDiv = document.createElement('div');
                buttonsDiv.classList.add('btn-wrapper');

                wrapperDiv.appendChild(buttonsDiv);
                document.body.appendChild(wrapperDiv);
                this.createButtons();
              }

              isAnOperation(dataId) {
                return Number.isNaN(parseInt(dataId, 10));
              }

              createButtons() {
                // C - global clear
                // ce - clear entry
                const buttonTags = this.buttons;

                const buttonWrapperDiv = document.querySelector('.btn-wrapper');
                buttonTags.forEach(obj => {
                  const tag = Object.values(obj)[0];
                  const value = Object.keys(obj)[0];

                  const button = document.createElement('span');
                  button.classList.add('btn');
                  button.setAttribute('data-id', tag);
                  button.textContent = value;
                  if (['C', 'CE'].includes(value)) {
                    button.classList.add('c-ce');
                    if (value === 'C') {
                      button.classList.add('clearAll')
                    } else if (value ==='CE') {
                      button.classList.add('clear');
                    }
                  } else if (['/', '*', '+', '-'].includes(value)) {
                    button.classList.add('op');
                  } else if (['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'].includes(value)) {
                    button.classList.add('digit');
                  } else if (value === '=') {
                    button.classList.add('result');
                  } else if (value==='NEG') {
                     button.classList.add('neg');
                  } else if (value === '.') {
                    button.classList.add('point');
                  }

                  buttonWrapperDiv.appendChild(button);
                });
              }

              printDigit(digit) {
                if (this.currentNumScreen.textContent === '0') {
                  this.clearCurrNumScreen();
                }

                if (this.resultStatus) {
                  this.clearCurrNumScreen();
                  this.resultStatus = false;
                }

                this.printToNumScreen(digit);
              }

              handleDigitClick(event) {
                event.preventDefault();
                // console.log(event.target.textContent)
                console.log(this)
                this.printDigit(event.target.textContent);
              }

              handleOpClick(event) {
                event.preventDefault();
                this.printOperator(event.target.textContent.trim());
              }

              clearAll(event) {
                this.clear(event);
                this.clearOpScreen();
                res.reset();
              }

              clear(event) {
                event.preventDefault();
                this.cleaCurrNumScreen();
                this.currNumScreen.textContent = '0';
              }

              handleResClick(event) {
                event.preventDefault();

                this.calculateResult();
                this.clearOpScreen();
                this.reset();
              }

              handleDotClick(event) {
                event.preventDefault();

                if (this.currentNumScreen.textContent.indexOf('.') === 1) {
                  this.printToNumScreen('.');
                }
              }

              reset() {
                this.result = 0;
                this.currentOp = '+';
              }

              printOperator(operator) {
                let prevOperationText = this.operationsScreen.textContent;
                let numAndOpToAdd = this.currentNumScreen.textContent + ' ' + operator + ' ';
                this.calculateResult();
                this.currentOp = operator;
                this.operationsScreen.textContent = prevOperationText + numAndOpToAdd;
              }

              cleaCurrNumScreen() {
                this.currentNumScreen.textContent = '';
              }

              clearOpScreen() {
                this.operationsScreen.textContent = '';
              }

              calculateResult() {
                let currentNumScreen = this.currentNumScreen.textContent;
                let num;
                if (currentNumScreen.includes('.')) {
                  num = parseFloat(currentNumScreen);
                } else {
                  num = parseInt(currentNumScreen);
                }

                switch (this.currentOp) {
                case '+':
                  this.result += num;
                  break;
                case '-':
                  this.result -= num;
                  break;
                case '/':
                  this.result /= num;
                  break;
                case '*':
                  this.result *= num;
                  break;
                case '%':
                  this.result = this.result % num;
                  break;
                }

                this.displayResult();
              }

              negateNum() {
                if (this.currentNumScreen.textContent !== '0') {
                  this.currentNumScreen.textContent = Math.abs(parseInt(this.currentNumScreen.textContent, 10)) * -1;
                }
              }

              displayResult() {
                this.currentNumScreen.textContent = this.result;
                this.resultStatus = true;
              }



              printToNumScreen(item) {
                let currText = this.currentNumScreen.textContent.trim();
                this.currentNumScreen.textContent = currText + item;
              }

              bindEvents() {
                Array.from(document.querySelectorAll('.digit')).forEach((digitButton) => {
                digitButton.addEventListener('click', this.handleDigitClick);
                });

                document.querySelectorAll('.op').forEach((opButton) => {
                opButton.addEventListener('click', this.handleOpClick);
                });

                document.querySelector('.result').addEventListener('click', this.handleResClick);
                document.querySelector('.neg').addEventListener('click', this.negateNum);
                document.querySelector('.clearAll').addEventListener('click', this.clearAll);
                document.querySelector('.clear').addEventListener('click', this.clear);
                document.querySelector('.point').addEventListener('click', this.handleDotClick);
              }
      }
    </script>
  </body>
</html>
